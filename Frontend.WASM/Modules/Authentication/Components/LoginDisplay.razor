@inject IAuthenticationService AuthService

<AuthorizeView>
    <Authorized>
        <MudMenu>
            <ActivatorContent>
                <MudButton Variant="Variant.Text" 
                           Color="Color.Inherit"
                           StartIcon="@Icons.Material.Filled.Person"
                           EndIcon="@Icons.Material.Filled.ArrowDropDown">
                    @GetDisplayName(context.User)
                </MudButton>
            </ActivatorContent>
            <ChildContent>
                <div class="px-4 pt-4 pb-2" style="min-width: 200px;">
                    <MudText Typo="Typo.body2" Class="mb-2">
                        @GetUserEmail(context.User)
                    </MudText>
                    <MudDivider Class="mb-2" />
                    <MudMenuItem OnClick="@SignOut" Icon="@Icons.Material.Filled.Logout">
                        Sign Out
                    </MudMenuItem>
                </div>
            </ChildContent>
        </MudMenu>
    </Authorized>
    <NotAuthorized>
        <MudButton Variant="Variant.Text" 
                   Color="Color.Inherit"
                   StartIcon="@Icons.Material.Filled.Login"
                   OnClick="@SignIn">
            Sign In
        </MudButton>
    </NotAuthorized>
</AuthorizeView>

@code {
    private async Task SignIn() {
        await AuthService.SignInAsync();
    }

    private async Task SignOut() {
        await AuthService.SignOutAsync();
    }

    private string GetDisplayName(System.Security.Claims.ClaimsPrincipal user) {
        return user.FindFirst("name")?.Value 
            ?? user.FindFirst(System.Security.Claims.ClaimTypes.Name)?.Value 
            ?? user.FindFirst("preferred_username")?.Value 
            ?? "User";
    }

    private string GetUserEmail(System.Security.Claims.ClaimsPrincipal user) {
        return user.FindFirst("email")?.Value 
            ?? user.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value 
            ?? user.FindFirst("preferred_username")?.Value 
            ?? "";
    }
}
@page "/error"
@inject NavigationManager NavigationManager

<PageTitle>Error - CIPP</PageTitle>

<div class="auth-container">
    <MudContainer MaxWidth="MaxWidth.Medium">
        <MudPaper Elevation="8" Class="pa-8">
            <div class="text-center mb-6">
                <MudIcon Icon="@Icons.Material.Filled.Error" Size="Size.Large" Color="Color.Error" Class="mb-4" />
                <MudText Typo="Typo.h4" Color="Color.Error" Class="mb-2">Server Error</MudText>
                <MudText Typo="Typo.h6" Class="mb-4">Status Code: @StatusCode</MudText>
            </div>

            @if (!string.IsNullOrEmpty(Endpoint)) {
                <MudAlert Severity="Severity.Info" Class="mb-4">
                    <MudText Typo="Typo.body2"><strong>Endpoint:</strong> @Endpoint</MudText>
                </MudAlert>
            }

            @if (!string.IsNullOrEmpty(Message)) {
                <MudAlert Severity="Severity.Error" Class="mb-4">
                    <MudText Typo="Typo.body1">@Message</MudText>
                </MudAlert>
            }

            @if (ParsedErrors != null && ParsedErrors.Any()) {
                <MudCard Class="mb-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h6">Error Details</MudText>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        @foreach (var error in ParsedErrors) {
                            <MudAlert Severity="Severity.Warning" Class="mb-2" Dense="true">
                                <MudText Typo="Typo.body2">@error</MudText>
                            </MudAlert>
                        }
                    </MudCardContent>
                </MudCard>
            }

            <MudDivider Class="my-4" />

            <div class="d-flex justify-center gap-4">
                <MudButton Variant="Variant.Filled" 
                           Color="Color.Primary" 
                           StartIcon="@Icons.Material.Filled.Refresh"
                           OnClick="@GoBack">
                    Go Back
                </MudButton>
                <MudButton Variant="Variant.Outlined" 
                           Color="Color.Primary" 
                           StartIcon="@Icons.Material.Filled.Home"
                           Href="/">
                    Go to Dashboard
                </MudButton>
            </div>
        </MudPaper>
    </MudContainer>
</div>

@code {
    [SupplyParameterFromQuery]
    public string? StatusCode { get; set; }

    [SupplyParameterFromQuery]
    public string? Endpoint { get; set; }

    [SupplyParameterFromQuery]
    public string? Message { get; set; }

    [SupplyParameterFromQuery]
    public string? Errors { get; set; }

    private List<string>? ParsedErrors => string.IsNullOrEmpty(Errors) 
        ? null 
        : Errors.Split("||", StringSplitOptions.RemoveEmptyEntries).ToList();

    private void GoBack() {
        NavigationManager.NavigateTo("/");
    }
}
